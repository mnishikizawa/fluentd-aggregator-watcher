<system>
  log_level trace
</system>

<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<source>
  @type monitor_agent
  port 24220
  bind 0.0.0.0
</source>

<match ping.**>
  @type copy
  <store>
  @type ping_message_checker
  tag  alert.ping_message
  check_interval 600      #default 3600
  notification_times 3
  notifications yes
  </store>
</match>

<match alert.ping_message>
    @type slack
    webhook_url {{ url }}
    channel #infra
    username s
    icon_emoji :x:
    color danger
    message Fluentd node has down :%s
    message_keys data
    flush_interval 1m
</match>

<source>
  @type ping_message
  tag watcher.standby
  data ${hostname}
  interval 30
</source>

<match watcher.standby>
  @type forward
  <server>
   name node03
   host 192.168.11.13
  </server>
</match>

<match watcher.active>
  @type copy
  <store>
  @type ping_message_checker
  tag  watcher.ping_message
  check_interval 600      #default 3600
  notification_times 3
  notifications yes
  </store>
</match>

<match watcher.ping_message>
    @type slack
    webhook_url {{ url }}
    channel #infra
    username s
    icon_emoji :x:
    color danger
    message Fluentd node has down :%s
    message_keys data
    flush_interval 1m
</match>

